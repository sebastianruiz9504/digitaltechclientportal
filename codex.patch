 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/Controllers/InventarioController.cs b/Controllers/InventarioController.cs
index 5064187c23c2cb658bdf0fc4d8e2947d7a7721b3..466cecd4b65b791d0d7b7b65d5d04277c25e0965 100644
--- a/Controllers/InventarioController.cs
+++ b/Controllers/InventarioController.cs
@@ -1,33 +1,33 @@
 using DigitalTechClientPortal.Models;
 using DigitalTechClientPortal.Services;
 using Microsoft.AspNetCore.Authorization;
 using Microsoft.AspNetCore.Mvc;
 using Microsoft.AspNetCore.WebUtilities;
-using Microsoft.Crm.Sdk.Messages;
 using Microsoft.PowerPlatform.Dataverse.Client;
 using Microsoft.Xrm.Sdk;
+using Microsoft.Xrm.Sdk.Messages;
 using Microsoft.Xrm.Sdk.Metadata;
 using Microsoft.Xrm.Sdk.Query;
 using System;
 using System.Collections.Generic;
 using System.IO;
 using System.Linq;
 using System.Net;
 using System.Net.Http;
 using System.Text;
 using System.Text.Json;
 using System.Threading;
 using System.Threading.Tasks;
 
 namespace DigitalTechClientPortal.Controllers
 {
     public sealed class ReportItem
     {
         public string Label { get; set; } = string.Empty;
         public int Count { get; set; }
     }
 
     [Authorize]
     [Route("[controller]")]
     public class InventarioController : Controller
     {
@@ -1529,50 +1529,110 @@ namespace DigitalTechClientPortal.Controllers
                     ? e.FormattedValues[PropioORentaAttribute]
                     : string.Empty;
                 var propioValue = e.GetAttributeValue<OptionSetValue>(PropioORentaAttribute)?.Value;
                 var actaNombre = e.GetAttributeValue<string>(ActaColumnName);
                 list.Add(new EquipoVm
                 {
                     Id = e.Id,
                     Marca = e.GetAttributeValue<string>("cr07a_marca") ?? string.Empty,
                     Modelo = e.GetAttributeValue<string>("cr07a_modelo") ?? string.Empty,
                     Serial = e.GetAttributeValue<string>("cr07a_serial") ?? string.Empty,
                     Estado = estadoFmt,
                     FechaCompra = e.GetAttributeValue<DateTime?>("cr07a_fechacompra"),
                     Ubicacion = ubicFmt,
                     Notas = e.GetAttributeValue<string>("cr07a_notas") ?? string.Empty,
                     AsignadoA = e.GetAttributeValue<string>("cr07a_asignadoa") ?? string.Empty,
                     PropioORentaValue = propioValue,
                     PropioORentaLabel = string.IsNullOrWhiteSpace(propioFmt) ? null : propioFmt,
                     TieneActaDeEntrega = !string.IsNullOrWhiteSpace(actaNombre),
                     ActaDeEntregaNombre = actaNombre
                 });
             }
             await PopulateAsignadoNombresAsync(list);
             return list;
         }
 
+        private async Task<List<UserInventoryViewModel>> GetUsuariosTenantAsync(int pageSize = 50)
+        {
+            if (pageSize <= 0)
+            {
+                pageSize = 50;
+            }
+
+            if (pageSize > 999)
+            {
+                pageSize = 999;
+            }
+
+            var usuarios = new List<UserInventoryViewModel>();
+
+            HttpClient httpClient;
+            try
+            {
+                httpClient = await _graphFactory.CreateClientAsync();
+            }
+            catch (InvalidOperationException)
+            {
+                return usuarios;
+            }
+
+            var url = "https://graph.microsoft.com/v1.0/users" +
+                "?$select=id,displayName,userPrincipalName,mail,jobTitle,department,mobilePhone" +
+                $"&$top={pageSize}" +
+                "&$orderby=displayName";
+
+            using var response = await httpClient.GetAsync(url);
+            if (!response.IsSuccessStatusCode)
+            {
+                return usuarios;
+            }
+
+            var raw = await response.Content.ReadAsStringAsync();
+            using var document = JsonDocument.Parse(raw);
+
+            if (!document.RootElement.TryGetProperty("value", out var valueElement) || valueElement.ValueKind != JsonValueKind.Array)
+            {
+                return usuarios;
+            }
+
+            foreach (var user in valueElement.EnumerateArray())
+            {
+                usuarios.Add(new UserInventoryViewModel
+                {
+                    Id = user.GetPropertyOrDefault("id"),
+                    DisplayName = user.GetPropertyOrDefault("displayName"),
+                    UserPrincipalName = user.GetPropertyOrDefault("userPrincipalName"),
+                    Mail = user.GetPropertyOrDefault("mail"),
+                    JobTitle = user.GetPropertyOrDefault("jobTitle"),
+                    Department = user.GetPropertyOrDefault("department"),
+                    MobilePhone = user.GetPropertyOrDefault("mobilePhone")
+                });
+            }
+
+            return usuarios;
+        }
+
         private static string? ExtractSkipToken(string nextLink)
         {
             if (string.IsNullOrEmpty(nextLink)) return null;
             try
             {
                 var uri = new Uri(nextLink);
                 var query = QueryHelpers.ParseQuery(uri.Query);
                 if (query.TryGetValue("$skiptoken", out var values))
                 {
                     var token = values.FirstOrDefault();
                     return string.IsNullOrEmpty(token) ? null : token;
                 }
             }
             catch
             {
                 var idx = nextLink.IndexOf("$skiptoken=", StringComparison.OrdinalIgnoreCase);
                 if (idx >= 0)
                 {
                     var val = nextLink[(idx + "$skiptoken=".Length)..];
                     return Uri.UnescapeDataString(val);
                 }
             }
 
             return null;
         }
 
EOF
)